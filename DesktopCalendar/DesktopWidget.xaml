<Window x:Class="DesktopCalendar.DesktopWidget"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="DeskFlow"
        Width="920" Height="560"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        Topmost="False"
        ShowInTaskbar="False"
        ResizeMode="CanResizeWithGrip"
        WindowStartupLocation="Manual"
        Left="50" Top="80"
        MouseLeftButtonDown="Window_MouseLeftButtonDown">

    <Window.Resources>
        <!-- å°éƒ¨ä»¶æŒ‰é’®æ ·å¼ -->
        <Style x:Key="WidgetButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="#70FFFFFF"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bd" Background="{TemplateBinding Background}" CornerRadius="6" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#15FFFFFF"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- è§†å›¾åˆ‡æ¢æŒ‰é’® -->
        <Style x:Key="ViewButton" TargetType="Border">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="#30FFFFFF"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="14,7"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        
        <!-- æžç®€æ»šåŠ¨æ¡æ ·å¼ -->
        <Style x:Key="MinimalScrollBar" TargetType="ScrollBar">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Width" Value="4"/>
            <Setter Property="Margin" Value="2,0,0,0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollBar">
                        <Grid Background="Transparent">
                            <Track x:Name="PART_Track" IsDirectionReversed="True">
                                <Track.Thumb>
                                    <Thumb>
                                        <Thumb.Template>
                                            <ControlTemplate TargetType="Thumb">
                                                <Border Background="#50FFFFFF" CornerRadius="2"/>
                                            </ControlTemplate>
                                        </Thumb.Template>
                                    </Thumb>
                                </Track.Thumb>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- å¸¦æžç®€æ»šåŠ¨æ¡çš„ListBoxæ ·å¼ -->
        <Style x:Key="MinimalListBox" TargetType="ListBox">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBox">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <ScrollViewer x:Name="PART_ScrollViewer" Grid.ColumnSpan="2" Focusable="False" Padding="0">
                                <ScrollViewer.Template>
                                    <ControlTemplate TargetType="ScrollViewer">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <!-- å†…å®¹åŒºï¼Œå³è¾¹ç•™8pxç»™æ»šåŠ¨æ¡ -->
                                            <ScrollContentPresenter Grid.Column="0" Margin="0,0,8,0"/>
                                            <!-- æ»šåŠ¨æ¡åœ¨å³è¾¹ç‹¬ç«‹ç©ºé—´ -->
                                            <ScrollBar x:Name="PART_VerticalScrollBar"
                                                       Grid.Column="1"
                                                       Orientation="Vertical"
                                                       Style="{StaticResource MinimalScrollBar}"
                                                       Value="{TemplateBinding VerticalOffset}"
                                                       Maximum="{TemplateBinding ScrollableHeight}"
                                                       ViewportSize="{TemplateBinding ViewportHeight}"
                                                       Visibility="{TemplateBinding ComputedVerticalScrollBarVisibility}"/>
                                        </Grid>
                                    </ControlTemplate>
                                </ScrollViewer.Template>
                                <ItemsPresenter/>
                            </ScrollViewer>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Border x:Name="WidgetBorder" CornerRadius="0" BorderBrush="Transparent" BorderThickness="0">
        <Border.Background>
            <SolidColorBrush Color="#000000" Opacity="0.45"/>
        </Border.Background>
        <Border.ContextMenu>
            <ContextMenu>
                <MenuItem Header="é€æ˜Žåº¦">
                    <MenuItem Header="70% (è¾ƒæ·±)" Tag="0.70" Click="SetOpacity_Click"/>
                    <MenuItem Header="55% (é»˜è®¤)" Tag="0.55" Click="SetOpacity_Click"/>
                    <MenuItem Header="45% (è¾ƒé€)" Tag="0.45" Click="SetOpacity_Click"/>
                    <MenuItem Header="35% (å¾ˆé€)" Tag="0.35" Click="SetOpacity_Click"/>
                </MenuItem>
                <MenuItem Header="ä¸»é¢˜é£Žæ ¼">
                    <MenuItem Header="æ·±è‰²" Tag="Dark" Click="SetTheme_Click"/>
                    <MenuItem Header="è“è‰²" Tag="Blue" Click="SetTheme_Click"/>
                    <MenuItem Header="ç´«è‰²" Tag="Purple" Click="SetTheme_Click"/>
                    <MenuItem Header="ç»¿è‰²" Tag="Green" Click="SetTheme_Click"/>
                </MenuItem>
                <Separator/>
                <MenuItem Header="æ‰“å¼€ä¸»ç•Œé¢" Click="OpenSettings_Click"/>
            </ContextMenu>
        </Border.ContextMenu>
        
        <Grid x:Name="MainGrid">
            <Grid.ColumnDefinitions>
                <ColumnDefinition x:Name="LeftColumn" Width="*" MinWidth="260" MaxWidth="360"/>
                <ColumnDefinition x:Name="RightColumn" Width="2*"/>
            </Grid.ColumnDefinitions>

            <!-- ========== å·¦ä¾§ï¼šå¾…åŠžæ¸…å• ========== -->
            <Border x:Name="LeftPanel" Grid.Column="0" BorderBrush="#15FFFFFF" BorderThickness="0,0,1,0" MinWidth="260">
                <Grid Margin="18,16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- æ ‡é¢˜æ  -->
                    <Grid Grid.Row="0" Margin="0,0,0,14">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock x:Name="TodoListTitle" Text="ä»Šæ—¥ä»»åŠ¡" FontSize="18" FontWeight="Bold" Foreground="White"/>
                            <Border Background="#3B82F6" CornerRadius="10" Padding="8,2" Margin="10,0,0,0" VerticalAlignment="Center">
                                <TextBlock x:Name="TodoCountBadge" Text="0" Foreground="White" FontSize="11" FontWeight="Medium"/>
                            </Border>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Content="å…¨éƒ¨" Style="{StaticResource WidgetButton}" FontSize="11" Click="ShowAllTodos_Click" ToolTip="æ˜¾ç¤ºå…¨éƒ¨å¾…åŠž"/>
                            <Button Content="ï¼‹" Style="{StaticResource WidgetButton}" FontSize="16" Click="AddTodo_Click" ToolTip="æ·»åŠ å¾…åŠž"/>
                            <!-- æ”¶èµ·/å±•å¼€æ—¥åŽ†æŒ‰é’® -->
                            <Border x:Name="ToggleCalendarBtn" Background="#20FFFFFF" CornerRadius="6" Padding="8,6" Margin="6,0,0,0" 
                                    Cursor="Hand" MouseLeftButtonDown="ToggleCalendar_Click" ToolTip="å±•å¼€/æ”¶èµ·æ—¥åŽ†">
                                <TextBlock x:Name="ToggleCalendarIcon" Text="ðŸ“…" FontSize="14"/>
                            </Border>
                        </StackPanel>
                    </Grid>
                    
                    <!-- å¿«é€Ÿæ·»åŠ  -->
                    <Border Grid.Row="1" Background="#10FFFFFF" CornerRadius="8" Padding="12,10" Margin="0,0,0,12">
                        <Grid>
                            <TextBox x:Name="QuickTodoInput" Background="Transparent" BorderThickness="0"
                                     Foreground="White" FontSize="13" CaretBrush="White" 
                                     KeyDown="QuickTodoInput_KeyDown"/>
                            <TextBlock Text="å¿«é€Ÿæ·»åŠ å¾…åŠž..." Foreground="#40FFFFFF" FontSize="13" IsHitTestVisible="False"
                                       Visibility="{Binding Text.Length, ElementName=QuickTodoInput, Converter={StaticResource LengthToVisibilityConverter}}"/>
                        </Grid>
                    </Border>

                    <!-- å¾…åŠžåˆ—è¡¨ -->
                    <ListBox Grid.Row="2" x:Name="TodoListBox" 
                             Style="{StaticResource MinimalListBox}"
                             ItemsSource="{Binding FilteredTodos}">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="0,3,0,3">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- å®ŒæˆæŒ‰é’®/å·²å®Œæˆæ ‡è®° -->
                                    <Border Grid.Column="0" Width="18" Height="18" CornerRadius="9" 
                                            BorderBrush="{Binding Priority, Converter={StaticResource PriorityToColorConverter}}" 
                                            BorderThickness="2" Margin="0,0,10,0" Cursor="Hand" VerticalAlignment="Top"
                                            Background="{Binding IsCompleted, Converter={StaticResource CompletedToBackgroundConverter}}"
                                            MouseLeftButtonDown="CompleteTodo_Click" Tag="{Binding Id}">
                                        <TextBlock Text="âœ“" Foreground="White" FontSize="10" FontWeight="Bold"
                                                   HorizontalAlignment="Center" VerticalAlignment="Center"
                                                   Visibility="{Binding IsCompleted, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                    </Border>
                                    
                                    <!-- å¾…åŠžå†…å®¹ï¼ˆç‚¹å‡»ç¼–è¾‘ï¼‰ -->
                                    <StackPanel Grid.Column="1" Cursor="Hand" Background="Transparent"
                                                MouseLeftButtonDown="TodoContent_Click" Tag="{Binding Id}">
                                        <TextBlock Text="{Binding Title}" FontSize="13" TextWrapping="Wrap"
                                                   Foreground="{Binding IsCompleted, Converter={StaticResource CompletedToForegroundConverter}}"
                                                   TextDecorations="{Binding IsCompleted, Converter={StaticResource CompletedToStrikethroughConverter}}"/>
                                        <StackPanel Orientation="Horizontal" Margin="0,3,0,0">
                                            <TextBlock Text="{Binding DueDate, StringFormat='Mæœˆdæ—¥'}" Foreground="#50FFFFFF" FontSize="10"
                                                       Visibility="{Binding DueDate, Converter={StaticResource NullToVisibilityConverter}}"/>
                                            <!-- é€¾æœŸæ ‡è®° -->
                                            <Border Background="#25EF4444" CornerRadius="2" Padding="4,1" Margin="6,0,0,0"
                                                    Visibility="{Binding IsOverdue, Converter={StaticResource BoolToVisibilityConverter}}">
                                                <TextBlock Text="é€¾æœŸ" Foreground="#EF4444" FontSize="9"/>
                                            </Border>
                                            <!-- é¡ºå»¶æŒ‰é’®ï¼ˆä»…é€¾æœŸæœªå®Œæˆä»»åŠ¡æ˜¾ç¤ºï¼‰ -->
                                            <Border Background="#25F59E0B" CornerRadius="2" Padding="4,1" Margin="4,0,0,0" Cursor="Hand"
                                                    Visibility="{Binding IsOverdue, Converter={StaticResource BoolToVisibilityConverter}}"
                                                    MouseLeftButtonDown="PostponeTask_Click" Tag="{Binding Id}" ToolTip="é¡ºå»¶åˆ°ä»Šå¤©">
                                                <TextBlock Text="â†’ä»Šå¤©" Foreground="#F59E0B" FontSize="9"/>
                                            </Border>
                                            <!-- å·²é¡ºå»¶æ ‡è®° -->
                                            <Border Background="#25F59E0B" CornerRadius="2" Padding="4,1" Margin="6,0,0,0"
                                                    Visibility="{Binding IsPostponed, Converter={StaticResource BoolToVisibilityConverter}}">
                                                <TextBlock Text="å·²é¡ºå»¶" Foreground="#F59E0B" FontSize="9"/>
                                            </Border>
                                            <!-- å·²å®Œæˆæ ‡è®° -->
                                            <Border Background="#2522C55E" CornerRadius="2" Padding="4,1" Margin="6,0,0,0"
                                                    Visibility="{Binding IsCompleted, Converter={StaticResource BoolToVisibilityConverter}}">
                                                <TextBlock Text="å·²å®Œæˆ" Foreground="#22C55E" FontSize="9"/>
                                            </Border>
                                        </StackPanel>
                                    </StackPanel>
                                    
                                    <!-- åˆ é™¤æŒ‰é’® -->
                                    <Button Grid.Column="2" Content="Ã—" Style="{StaticResource WidgetButton}" 
                                            FontSize="14" Foreground="#60FFFFFF" Padding="4,2" VerticalAlignment="Top"
                                            Click="DeleteTodo_Click" Tag="{Binding Id}" ToolTip="åˆ é™¤"/>
                                </Grid>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                        <ListBox.ItemContainerStyle>
                            <Style TargetType="ListBoxItem">
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="Padding" Value="0"/>
                                <Setter Property="Margin" Value="0"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="ListBoxItem">
                                            <Border x:Name="Bd" Background="{TemplateBinding Background}" Padding="8,6" CornerRadius="6">
                                                <ContentPresenter/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="Bd" Property="Background" Value="#10FFFFFF"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </ListBox.ItemContainerStyle>
                    </ListBox>
                    
                    <!-- ç©ºçŠ¶æ€ -->
                    <StackPanel x:Name="EmptyTodoState" Grid.Row="2" VerticalAlignment="Center" HorizontalAlignment="Center"
                                Visibility="Collapsed">
                        <TextBlock Text="âœ¨" FontSize="28" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                        <TextBlock Text="æš‚æ— å¾…åŠž" Foreground="#50FFFFFF" FontSize="13" HorizontalAlignment="Center"/>
                    </StackPanel>

                    <!-- åº•éƒ¨ï¼šç»Ÿè®¡ -->
                    <StackPanel Grid.Row="3" Margin="0,10,0,0">
                        <!-- ç»Ÿè®¡ -->
                        <Border Background="#10FFFFFF" CornerRadius="8" Padding="12,10">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                                    <TextBlock x:Name="StatToday" Text="0" Foreground="#3B82F6" FontSize="18" FontWeight="Bold" HorizontalAlignment="Center"/>
                                    <TextBlock Text="ä»Šæ—¥" Foreground="#50FFFFFF" FontSize="10" HorizontalAlignment="Center"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                                    <TextBlock x:Name="StatOverdue" Text="0" Foreground="#EF4444" FontSize="18" FontWeight="Bold" HorizontalAlignment="Center"/>
                                    <TextBlock Text="é€¾æœŸ" Foreground="#50FFFFFF" FontSize="10" HorizontalAlignment="Center"/>
                                </StackPanel>
                                <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                                    <TextBlock x:Name="StatCompleted" Text="0" Foreground="#22C55E" FontSize="18" FontWeight="Bold" HorizontalAlignment="Center"/>
                                    <TextBlock Text="å®Œæˆ" Foreground="#50FFFFFF" FontSize="10" HorizontalAlignment="Center"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- ========== å³ä¾§ï¼šæœˆåŽ† ========== -->
            <Grid x:Name="RightPanel" Grid.Column="1" Margin="18,16">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- å½“å‰æ—¶é—´æ˜¾ç¤º + ä¸»ç•Œé¢æŒ‰é’® -->
                <Grid Grid.Row="0" Margin="0,0,0,12">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock x:Name="CurrentTime" Text="00:00" FontSize="36" FontWeight="Light" Foreground="White"/>
                        <StackPanel Margin="14,6,0,0">
                            <TextBlock x:Name="CurrentDate" Text="2024å¹´1æœˆ1æ—¥" Foreground="#90FFFFFF" FontSize="13"/>
                            <TextBlock x:Name="CurrentWeekday" Text="æ˜ŸæœŸä¸€" Foreground="#60FFFFFF" FontSize="12"/>
                        </StackPanel>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                        <TextBlock Text="æŒ‰ ` éšè—" Foreground="#50FFFFFF" FontSize="11" VerticalAlignment="Center" Margin="0,0,12,0"/>
                        <Border CornerRadius="16" Cursor="Hand" MouseLeftButtonDown="OpenMainWindow_Click" Padding="14,8"
                                BorderBrush="#606366F1" BorderThickness="1">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#806366F1" Offset="0"/>
                                    <GradientStop Color="#808B5CF6" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background">
                                                <Setter.Value>
                                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                        <GradientStop Color="#A06366F1" Offset="0"/>
                                                        <GradientStop Color="#A08B5CF6" Offset="1"/>
                                                    </LinearGradientBrush>
                                                </Setter.Value>
                                            </Setter>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ " FontSize="14" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                <TextBlock Text="ä¸»ç•Œé¢" Foreground="White" FontSize="13" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Grid>

                <!-- æ—¥åŽ†å¤´éƒ¨ -->
                <Grid Grid.Row="1" Margin="0,0,0,12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- æœˆä»½å¯¼èˆª -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                        <Button Content="â—€" Style="{StaticResource WidgetButton}" FontSize="12" Padding="10,6" Click="PrevMonth_Click"/>
                        <TextBlock x:Name="MonthLabel" Text="2024å¹´10æœˆ" Foreground="White" FontSize="16" FontWeight="SemiBold"
                                   VerticalAlignment="Center" Margin="8,0"/>
                        <Button Content="â–¶" Style="{StaticResource WidgetButton}" FontSize="12" Padding="10,6" Click="NextMonth_Click"/>
                        <Button Content="ä»Šå¤©" Style="{StaticResource WidgetButton}" Foreground="#3B82F6" FontSize="12" Margin="12,0,0,0" Click="GoToday_Click"/>
                    </StackPanel>

                    <!-- è§†å›¾åˆ‡æ¢æŒ‰é’® -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <Border x:Name="ViewDay" Style="{StaticResource ViewButton}" Background="#3B82F6" BorderBrush="#3B82F6" Margin="0,0,6,0" MouseLeftButtonDown="SwitchView_Click" Tag="Day">
                            <TextBlock Text="å¤©" Foreground="White" FontSize="12"/>
                        </Border>
                        <Border x:Name="ViewWeek" Style="{StaticResource ViewButton}" MouseLeftButtonDown="SwitchView_Click" Tag="Week">
                            <TextBlock Text="å‘¨" Foreground="#90FFFFFF" FontSize="12"/>
                        </Border>
                    </StackPanel>
                </Grid>

                <!-- æ˜ŸæœŸè¡Œ -->
                <UniformGrid x:Name="WeekdayRow" Grid.Row="2" Columns="7" Margin="0,0,0,6">
                    <TextBlock Text="ä¸€" Foreground="#60FFFFFF" FontSize="12" HorizontalAlignment="Center" FontWeight="Medium"/>
                    <TextBlock Text="äºŒ" Foreground="#60FFFFFF" FontSize="12" HorizontalAlignment="Center" FontWeight="Medium"/>
                    <TextBlock Text="ä¸‰" Foreground="#60FFFFFF" FontSize="12" HorizontalAlignment="Center" FontWeight="Medium"/>
                    <TextBlock Text="å››" Foreground="#60FFFFFF" FontSize="12" HorizontalAlignment="Center" FontWeight="Medium"/>
                    <TextBlock Text="äº”" Foreground="#60FFFFFF" FontSize="12" HorizontalAlignment="Center" FontWeight="Medium"/>
                    <TextBlock Text="å…­" Foreground="#EF4444" FontSize="12" HorizontalAlignment="Center" FontWeight="Medium"/>
                    <TextBlock Text="æ—¥" Foreground="#EF4444" FontSize="12" HorizontalAlignment="Center" FontWeight="Medium"/>
                </UniformGrid>

                <!-- æ—¥åŽ†ç½‘æ ¼ -->
                <UniformGrid x:Name="CalendarGrid" Grid.Row="3" Columns="7" Rows="6"/>
            </Grid>

            <!-- ========== æ·»åŠ å¾…åŠžå¼¹çª— ========== -->
            <Border x:Name="AddTodoPopup" Grid.ColumnSpan="2" Visibility="Collapsed" Background="#E0080810">
                <Border CornerRadius="14" Width="360" VerticalAlignment="Center" HorizontalAlignment="Center"
                        Padding="24" BorderBrush="#25FFFFFF" BorderThickness="1">
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                            <GradientStop Color="#F8181822" Offset="0"/>
                            <GradientStop Color="#F8101018" Offset="1"/>
                        </LinearGradientBrush>
                    </Border.Background>
                    <StackPanel>
                        <Grid Margin="0,0,0,18">
                            <TextBlock x:Name="PopupTitle" Text="æ·»åŠ å¾…åŠž" Foreground="White" FontSize="18" FontWeight="SemiBold"/>
                            <Button Content="Ã—" HorizontalAlignment="Right" Style="{StaticResource WidgetButton}" FontSize="20" Click="ClosePopup_Click"/>
                        </Grid>
                        
                        <!-- è¾“å…¥æ¡† -->
                        <Border Background="#15FFFFFF" CornerRadius="10" Padding="14,12" Margin="0,0,0,16" BorderBrush="#15FFFFFF" BorderThickness="1">
                            <TextBox x:Name="TodoInput" Background="Transparent" BorderThickness="0"
                                     Foreground="White" FontSize="14" CaretBrush="White" KeyDown="TodoInput_KeyDown"/>
                        </Border>
                        
                        <!-- ä¼˜å…ˆçº§é€‰æ‹© -->
                        <TextBlock Text="ä¼˜å…ˆçº§" Foreground="#60FFFFFF" FontSize="11" Margin="0,0,0,8"/>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,18">
                            <Border x:Name="HighPriorityBtn" Background="Transparent" BorderBrush="#EF4444" BorderThickness="1.5" 
                                    CornerRadius="8" Padding="16,8" Margin="0,0,10,0" Cursor="Hand" MouseLeftButtonDown="Priority_Click" Tag="High">
                                <StackPanel Orientation="Horizontal">
                                    <Ellipse Width="8" Height="8" Fill="#EF4444" Margin="0,0,6,0"/>
                                    <TextBlock Text="ç´§æ€¥" Foreground="#EF4444" FontSize="12"/>
                                </StackPanel>
                            </Border>
                            <Border x:Name="MediumPriorityBtn" Background="Transparent" BorderBrush="#F97316" BorderThickness="1.5" 
                                    CornerRadius="8" Padding="16,8" Margin="0,0,10,0" Cursor="Hand" MouseLeftButtonDown="Priority_Click" Tag="Medium">
                                <StackPanel Orientation="Horizontal">
                                    <Ellipse Width="8" Height="8" Fill="#F97316" Margin="0,0,6,0"/>
                                    <TextBlock Text="é‡è¦" Foreground="#F97316" FontSize="12"/>
                                </StackPanel>
                            </Border>
                            <Border x:Name="LowPriorityBtn" Background="Transparent" BorderBrush="#22C55E" BorderThickness="1.5" 
                                    CornerRadius="8" Padding="16,8" Cursor="Hand" MouseLeftButtonDown="Priority_Click" Tag="Low">
                                <StackPanel Orientation="Horizontal">
                                    <Ellipse Width="8" Height="8" Fill="#22C55E" Margin="0,0,6,0"/>
                                    <TextBlock Text="æ™®é€š" Foreground="#22C55E" FontSize="12"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                        
                        <!-- æ·»åŠ æŒ‰é’® -->
                        <Button Content="æ·»åŠ å¾…åŠž" Foreground="White" BorderThickness="0" Padding="0,14" FontSize="14" FontWeight="Medium"
                                Cursor="Hand" Click="SubmitTodo_Click">
                            <Button.Background>
                                <LinearGradientBrush EndPoint="1,0">
                                    <GradientStop Color="#6366F1" Offset="0"/>
                                    <GradientStop Color="#8B5CF6" Offset="1"/>
                                </LinearGradientBrush>
                            </Button.Background>
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}" CornerRadius="10" Padding="{TemplateBinding Padding}">
                                        <ContentPresenter HorizontalAlignment="Center"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Opacity" Value="0.9"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </StackPanel>
                </Border>
            </Border>
            
            <!-- ========== ç¼–è¾‘å¾…åŠžå¼¹çª— ========== -->
            <Border x:Name="EditTodoPopup" Grid.ColumnSpan="2" Visibility="Collapsed" Background="#E0080810">
                <Border CornerRadius="14" Width="360" VerticalAlignment="Center" HorizontalAlignment="Center"
                        Padding="24" BorderBrush="#25FFFFFF" BorderThickness="1">
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                            <GradientStop Color="#F8181822" Offset="0"/>
                            <GradientStop Color="#F8101018" Offset="1"/>
                        </LinearGradientBrush>
                    </Border.Background>
                    <StackPanel>
                        <Grid Margin="0,0,0,18">
                            <TextBlock Text="ç¼–è¾‘å¾…åŠž" Foreground="White" FontSize="18" FontWeight="SemiBold"/>
                            <Button Content="Ã—" HorizontalAlignment="Right" Style="{StaticResource WidgetButton}" FontSize="20" Click="CloseEditPopup_Click"/>
                        </Grid>
                        
                        <!-- è¾“å…¥æ¡† -->
                        <Border Background="#15FFFFFF" CornerRadius="10" Padding="14,12" Margin="0,0,0,16" BorderBrush="#15FFFFFF" BorderThickness="1">
                            <TextBox x:Name="EditTodoInput" Background="Transparent" BorderThickness="0"
                                     Foreground="White" FontSize="14" CaretBrush="White" KeyDown="EditTodoInput_KeyDown"/>
                        </Border>
                        
                        <!-- ä¼˜å…ˆçº§é€‰æ‹© -->
                        <TextBlock Text="ä¼˜å…ˆçº§" Foreground="#60FFFFFF" FontSize="11" Margin="0,0,0,8"/>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,18">
                            <Border x:Name="EditHighPriorityBtn" Background="Transparent" BorderBrush="#EF4444" BorderThickness="1.5" 
                                    CornerRadius="8" Padding="16,8" Margin="0,0,10,0" Cursor="Hand" MouseLeftButtonDown="EditPriority_Click" Tag="High">
                                <StackPanel Orientation="Horizontal">
                                    <Ellipse Width="8" Height="8" Fill="#EF4444" Margin="0,0,6,0"/>
                                    <TextBlock Text="ç´§æ€¥" Foreground="#EF4444" FontSize="12"/>
                                </StackPanel>
                            </Border>
                            <Border x:Name="EditMediumPriorityBtn" Background="Transparent" BorderBrush="#F97316" BorderThickness="1.5" 
                                    CornerRadius="8" Padding="16,8" Margin="0,0,10,0" Cursor="Hand" MouseLeftButtonDown="EditPriority_Click" Tag="Medium">
                                <StackPanel Orientation="Horizontal">
                                    <Ellipse Width="8" Height="8" Fill="#F97316" Margin="0,0,6,0"/>
                                    <TextBlock Text="é‡è¦" Foreground="#F97316" FontSize="12"/>
                                </StackPanel>
                            </Border>
                            <Border x:Name="EditLowPriorityBtn" Background="Transparent" BorderBrush="#22C55E" BorderThickness="1.5" 
                                    CornerRadius="8" Padding="16,8" Cursor="Hand" MouseLeftButtonDown="EditPriority_Click" Tag="Low">
                                <StackPanel Orientation="Horizontal">
                                    <Ellipse Width="8" Height="8" Fill="#22C55E" Margin="0,0,6,0"/>
                                    <TextBlock Text="æ™®é€š" Foreground="#22C55E" FontSize="12"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                        
                        <!-- ä¿å­˜æŒ‰é’® -->
                        <Button Content="ä¿å­˜ä¿®æ”¹" Foreground="White" BorderThickness="0" Padding="0,14" FontSize="14" FontWeight="Medium"
                                Cursor="Hand" Click="SaveEditTodo_Click">
                            <Button.Background>
                                <LinearGradientBrush EndPoint="1,0">
                                    <GradientStop Color="#6366F1" Offset="0"/>
                                    <GradientStop Color="#8B5CF6" Offset="1"/>
                                </LinearGradientBrush>
                            </Button.Background>
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}" CornerRadius="10" Padding="{TemplateBinding Padding}">
                                        <ContentPresenter HorizontalAlignment="Center"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Opacity" Value="0.9"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </StackPanel>
                </Border>
            </Border>
        </Grid>
    </Border>
</Window>
